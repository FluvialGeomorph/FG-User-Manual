# Level-2-2 Channel Bankfull Analysis

The purpose of this SOP is to demonstrate the workflow of fluvial geomorphology (fluvgeo) rapid watershed assessment in ArcGIS Pro. This approach uses a suite of planning analysis tools to rapidly assess and identify sediment sources, pathways, and sinks for watershed analysis.
Level 2 is to estimate the detrended bankfull elevation for the base year for each reach. This is accomplished by identifying and mapping of all cross sections and roughly estimate channel bankfull dimensions and profile for each reach.
The data from level 1 will be needed to start the level 2 process. This analysis begins with modifications to the cross sections.



## Application and Data Setup

### 	Applications
 1.	ArcGIS Pro mapping application with adequate system privileges ArcGIS Pro w/Admin Privileges to install and update toolsets.
 2.	R, Rstudio and Rtools to run the Fluvgeo tools in ArcGIS Pro. 

###	Retreive the most current version of FluvGeo Toolbox from GITHUB 
 1.	Get the latest version of the toolbox from this page under Releases.<https://github.com/FluvialGeomorph/FluvialGeomorph-toolbox>
 2.	Place the install in a location that all required applications can access.
 3.	In Rstudio under tools install package HERE. 
 4.	In ArcCatalog open the Fluvgeo toolbox and under install click Install R Package box and Hit run.

### 	Data access in ArcGIS Pro
 1.	Fluvgeo toolbox requires the use of a mapped drive for accessing the data in ArcGIS Pro. CNC connection will create errors with some of the Fluvgeo tools.
 2.	Create a mapped drive and use that connection in ArcCatalog. 

## Analysis Workflow 

###	Extend original XS_layout
 1.	Use the original XS lines from level1 and extend each XS line high ground to high ground of the dem_hydro outside the floodplain on     each side. XS extent must be beyond the floodplain at minimum and kept perpendicular to the channel. 
 2.	Save edits.
 3.	Import the extended XS line layer into the older geodatabase.


### 	Calculate Cross Section Watershed Area 
 1.	Go to FluvialGeomorph toolbox open the XS Wastershed Area tool.
 2.	Start with the more recent data first.
 3.	Add the feature dataset.
 4.	Add the extended XS line layer.
 5.	Add the flowline.
 6.	Add the flow_accum created in level or refer to level 1 instructions.
 7.	Snap distance is 100.
 8.	Hit Run.
    i.	If it doesn’t work zoom into the mile radius of site and clip FAC. Having a smaller clip will also reduce the tool runtime. 
    ii.	The result is a new attribute field in the XS feature class that has a calculated watershed area for each regularly spaced cross        section.
 9.	Once it is done running, open attribute table and see if anything in the watershedareaSqMile is off.
    i.	Some of the cross sections Watershed_Area_SqMile may not follow the trend. If this is the case, manually enter in the values to     fill in the gaps. If most of the cross sections are missing these or display incorrect values, rerun Tool 12 Watershed Area and         increase the snap distance.
    ii.	Check for other streams and bodies of water feeding into the stream that would validate the abrupt changes in the watershed area.
 10.	Run for older geodatabase.

### 	XS River Position 
 1.	In the FluvialGeomorph toolbox, select XS River Position.
 2.	Enter feature dataset for more recent geodatabase.
 3.	Input extended XS.
 4.	Input Flowline Points.
 5.	Hit Run. Complete for both the channel and floodplain XS
 6.	The result adds new fields in the attribute table of the XS feature class. 
 7.	Two temporary charts will populate the Contents tab under the Cross Section Line Feature Class (XS Seq by km_to_mouth, XS Seq by Watershed Area sq mile). If the charts are removed from the contents pane, you will need to run the XS River Position Tool to view them again.
    i.	Open both Charts and inspect for any issues in the data.
    ii.	Note: This step provides charts which help see if there are gaps in the data.
 8.	Repeat XS River Position for the older gdb.

### 	XS Points 
1.	In the FluvialGeomorph toolbox, select XS Points.
2.	Enter feature dataset for more recent geodatabase.
3.	Input extended Cross Sections.
4.	Input dem_hydro.
5.	Change dem_units to ft.
6.	Input REM for the detrend_dem.
7.	Station Distance is 1.
8.	Hit Run. Complete for both the channel and floodplain XS.
9.	Points have been created every foot along the Cross Section with an Elevation. This will provide a visual elevation profile for each cross section.
10.	Repeat these steps for the older gdb.

### 	XS Point Classify - 14a
1.	In the FluvialGeomorph toolbox, select XS Points Classify.
2.	Enter feature dataset for the most recent year.
3.	Input extended XS points.
4.	Input channel polygon.
5.	Input floodplain polygon.
6.	Leave buffer distance default.
7.	Repeat for earlier year extended XS Points.

### 	Create Banklines 

1.	Turn channel bank_raw polygon layer into a line layer. 
2.	Use Esri Poygon to Line tool.
3.	Add the bank_raw channel polygon as the input feature.
4.	Add the feature dataset for the more recent gdb.
5.	Hit Run.

### 	Edit channel line layer 

::: {style="float: right; margin:1px 10px;"}

![Step 2](images/banklines.jpg){width="1.5in"}

:::

1.	Split the line and remove all parts that are not the streambank length of the flowline.  
2.	Set the flow on each streambank line to flow downstream. (Make sure the RED node is at the upstream end of the line and both ends are snapped together)    
3.	Save edits. 

<br>

                                      
### 	XS Dimensions Level 1 
1.	In the FluvialGeomorph toolbox, open XS Dimensions, Level 1.
2.	Extended XS’s for the newest year are added into xs_line fc.
3.	Enter 4 for the lead_n.
    i.	This sets the moving window to average 4 XS’s above and below the XS being calculated.
4.	Leave the use_smoothing box unchecked and loess_span as 0.1.
5.	Check that the vert_units are in ft.
6.	After the tool completes, refresh the folder the gdb is in and you should find a .csv file in there.

### 	Join from CSV (Data Management toolbox)
1.	In the FluvialGeomorph toolbox, open Join From CSV located in the Data Management toolset.
2.	Feature_dataset will be the feature dataset of the most recent gdb.
3.	Fc will be the XS line feature class.
4.	Choose Seq in the dropdown for the fc_field.
5.	The csv_file will be the .csv file created from the XS Dimensions Level 1 Tool.
6.	Csv_field will match the fc_field so it should also be Seq.
7.	Hit Run.
8.	A new line feature class ending with dims_L1 will be added to the feature dataset.

###	Go to the USGS StreamStats website to get the 50-percent AEP flood value for the stream reach . 

:::{.callout-note}

    Other sources can be used to get the watershed discharge. 
    Check with hydrologist requesting the analysis for additional sources.

:::
    
::: {style="float: right; margin:1px 20px;"}

![Step 3. i](images/sswatershed.jpg){width="2in"}

:::

1.	Select the state of the reach on the left of the stream.
2.	Zoom into the location for the stream reach until the stream layer shows.
3.	Click the delineate button.
    i.	On the map select the base of the stream reach. The watershed calculation will start. When it is complete a delineation of the reach will show.
    ii.	  Click Continue. 
    iii.    Select all 4 options under Regression Based Scenarios.
    iv.	Below expand Basin Characteristics and Select All Basin Characteristics.
    v.	Click Continue. The calculations for the report will run.
    vi.	Once the calculations are completed scroll to the bottom of the left panel, check all the boxes and click Open             Report.
    vii.	Add the site name to the report title.
        a.	Ex. Site193 JODAVIESS County SWCD Stream Stats Report.
    viii.	Add any comments need to the comment section.
    ix.	Scroll to the bottom and print the report to PDF. Save to the site folder.


###	Open the PDF Stream Stats Report from the site folder. 

::: {style="float: none; margin:1px 30px;"}

![](images/stats.jpg){width="6in"}

:::

1.	Locate the 50-percent AEP flood value under the Peak-Flow Statistics Flow Report section around page 8 of the report. This value will be used in the Level 2 report.



## Run Report


### 	L2 XS Dimensions 
1.	In the FluvialGeomorph toolbox, open XS Dimensions, Level 2.
2.	XS’s dimension level 1 for the riffles into extended xs_line fc. 
3.	XS’s_points for the channel riffles are added to the extended XS_point_fc. 
4.	Bankfull_elevation is from the channel depth of the bank_raw channel layer. Ex. 103.5
5.	Enter 4 for the lead_n.
    i.	This sets the moving window to average 4 XS’s above and below the XS being calculated.
6.	Leave the use_smoothing box unchecked and loess_span as 0.1. Can be adjusted up to 1.
7.	Check that the vert_units are in ft.
8.	Discharge method is model_measure.
9.	Discharge_value is the 50-percent AEP flood value from the watershed discharge report.
10.	After the tool completes, refresh the folder the gdb is in and you should find a .csv file in there.

### 	Join from CSV 
1.	In the FluvialGeomorph toolbox, open Join From CSV located in the Data Management toolset.
2.	Feature_dataset will be the feature dataset of the most recent gdb.
3.	Fc will be the extended XS _layout_dims_L1 line feature class.
4.	Choose Seq in the dropdown for the fc_field.
5.	The csv_file will be the .csv file created from the XS Dimensions Level 2 Tool.
6.	Csv_field will match the fc_field so it should also be Seq.
7.	Hit Run.
8.	A new line feature class ending with dims_L2 will be added to the feature dataset.

### 	Generate Level 2 Report
1.	In the FluvialGeomorph toolbox, open the Report – L2b located in the Reports toolset.
2.	Stream will be the ReachName which was created when making the flowline. Copy and paste the ReachName from XS’s attribute table.
3.	Flowline_fc will be the flowline feature class from the recent survey event.
4.	Extended Xs_fc will be the XS feature class for the most recent survey event.
5.	Extended Xs_dimensions_fc will be the line feature class created during the Join From CSV tool.
6.	Extended Xs_points_1 will be the XS points point feature class created from the XS Points tool. Use the data from the most recent survey event.
    i.	Extended Xs_points_2 will be the XS points point feature class for the older year.
7.	Survey_name_1 will be the survey event of the most recent data (ex: 2022).
    i.	Survey_name_2 will be the survey event of the older data (ex: 2012).
8.	Features_fc will need the features point feature class that was created to indicate roadways, site improvements, or other bodies of water.
9.	Channel_fc will be the lower number bank_raw layer that represents the channel.
10.	Floodplain_fc will be the higher number bank_raw layer that represents the floodplain,
11.	Dem will need the dem_hydro from the most recent survey event.
12.	Bf_estimate will be the 50-percent AEP flood from Stream Stats or other source.
13.	Regions will be selected based on needs for the site. They calculate an estimate of specific hydraulic dimension for a given drainage area. One to four curves can be selected for a report.  Ex. IL sites normally use Southern Driftless, Lower Southern Driftless, and Eastern United States. 
14.	Check the box for: show_xs_map.
1.	Change profile_units to feet.
16.	Check boxes for aerial and elevation.
17.	Xs_label_freq and exaggeration should already be set to 10 and extent_factor is 1.2.
18.	Output_dir is where the report will be stored. Each project has a Reports folder. 
19.	Output_format is word_document.
20.	Hit Run.
21.	Review report for errors and anomalies in the data. 


