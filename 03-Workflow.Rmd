# Workflow
This chapter provides an overview of some of the workflows that can be used to perform a rapid watershed assessment using `FluvialGeomorph`. Through analyzing a wide range of sites, we have created a standard analysis framework. This framework defines a series of standard analysis objects that are used in a regular process to perform different types of analysis. 


## Units of Analysis
To help organize the workflow process we have defined several units of analysis:

**Project:** These are the primary work units and correspond to projects that customers have requested for analysis. Customers define specific goals for each project that determine the specific workflow chosen. These goals define a project study area for each project. These project study areas typically consist of a particular watershed, a mainstem section of a named river, or a discrete stream reach. 

**Site:** Project areas are subdivided into "sites". Sites are typically named tributaries and their subwatersheds within the project study area.   

**Reach:** Sites are further subdivided into "reaches". Reaches are defined according to project goals and use conventional rules for specifying reaches (i.e., tributary confluence to confluence), significant infrastructure, changes in surficial geology, etc.   

**Year:** Since `FluvialGeomorph` analysis is based on LiDAR terrain surveys, the timing of the survey is a critical factor in the analysis. LiDAR is a single point-in-time dataset. Since LiDAR can be collected periodically, our data structure must accommodate multiple distinct time periods for which channel dimensions are extracted. If there are multiple LiDAR surveys available for the project study area, the most recent survey is referred to as the base year. 


## Analysis Levels
We have defined a standard workflow that is modular, allowing analysts to prescribe and customers to purchase progressively more detailed analysis as needed. The workflow is organized according to the following levels:

**Level 1:** The purpose of Level 1 is to extract basic channel dimensions. 

**Level 2:** The purpose of Level 2 is to extract bankfull channel dimensions. 

**Level 3:** The purpose of Level 3 is to extract planform dimensions. 


## Geodatabases
The `FluvialGeomorph` workflow was designed around a standard set of objects organized into a standard set of geodatabases. 

**Study Area Geodatabase:** This type of geodatabase stores feature classes (FC) that apply to the entire project study area or site. The workflow begins with developing FCs that define the project study area, Digital Elevation Model (DEM), derived stream network, etc. If there are multiple LiDAR surveys for the project study area, a separate study area geodatabase representing each survey is created beginning with the base year. 

**Reach Geodatabase:** This type of geodatabases stores FCs that apply to a specific reach. The `FluvialGeomorph` tools create a standard set of FCs. Creating a separate geodatabase for each reach allows these standard FCs to be created for each "reach" unit of analysis. If there are multiple LiDAR surveys for the project study area, a separate reach geodatabase representing each survey is created beginning with the base year. 


## Derived Features
The definition of a common set of derived features is an important step in standardizing the FluvialGeomorph workflow. These database objects form a tightly linked set of features that work together in a particular order to accomplish the analysis. They are presented here in the approximate order in which they are produced. 

### Terrain Model Raster
The GIS analyst uses standard ESRI geoprocessing tools to transform a LiDAR point cloud dataset covering the study area into an appropriately resolute (pixel cell size) digital elevation model (DEM). Only points representing the ground or water surface are selected from the point cloud to derive the terrain surface DEM. This raster dataset is named `dem`, but can also have a suffix added to represent its year of collection in change studies. 

### Cutlines
The `cutlines` polyline feature class is used to store geometry needed to hydrologically modify a terrain model to ensure that water can accurately flow over the land surface as it does in the real world. LiDAR derived terrain models frequently contain flow blockages (e.g., road berms) that must be "cut-through" to represent the presence of flow structures (e.g., culverts, bridges) that cannot be resolved directly from the LiDAR terrain model. 

### Hydro-Modified Raster
Before the `dem` terrain model raster can be used for synthetically deriving stream features, it must first be hydrologically modified using the `cutlines` feature class to "burn" flow paths into the `dem` raster. This "hydro-enforced" DEM is named `dem_hydro`. 

### Contributing Area Raster
The `dem_hydro` raster dataset is used to create a `contributing_area` raster whose values store the drainage area upstream of each pixel. 

### Stream Network
The `contributing_area` raster dataset is used to derive a synthetic `stream_network` polyline feature class representing the stream network of the study area. 

### Stream Network Points
The `stream_network_points` point feature class is used to represent regularly spaced points along a `stream_network` feature class. These `stream_network_points` features are used to store elevation and route position (longitudinal stream stationing) information for a `stream_network` feature. `stream_network_points` are used to calculate several stream longitudinal dimensions. 

### Watershed
The `watershed` polygon feature class is used to represent the upstream drainage area of a single point (aka "pour point") located along a stream network. All pixels within each `watershed` polygon feature flow to the stream network point used to derive the watershed. 

### Flowline
The `flowline` polyline feature class is used to represent the likely flow path of a stream reach within a study area. This is the primary flow path feature used in the FluvialGeomorph toolbox. Since non-bathymetric LiDAR is often used to derive `flowline` features, this should not be interpreted as the thalweg when water is present in the DEM.  

### Flowline Points
The `flowline_points` point feature class is used to represent regularly spaced points along a `flowline` feature class. These `flowline_points` features are used to store elevation and route position (longitudinal stream stationing) information for a `flowline` feature. `flowline_points` are used to calculate a series of stream longitudinal dimensions. 

### Detrended Raster
The `detrend` raster dataset is an elevation model where the downstream slope of the `dem_hydro` has been removed. 

### Channel Slope Raster
The `channel_slope` raster represents the slope of the `dem_hydro` within the channel. This is not to be confused with the longitudinal slope of the stream reach, but is the pixel-wise, raster surface slope of the channel area. 

### Regular Cross Sections
Cross sections are polyline feature classes drawn perpendicular to the `flowline` feature and are long enough to extend across some portion of the channel and floodplain. Cross section features are used to define channel cross section dimensions. Regular cross sections are created using a tool and spaced equal distances longitudinally along the `flowline`. Regularly spaced cross sections are used to sample conditions within a stream reach to either display a continuous series of values or calculate aggregate stream values. 

### Riffle Cross Sections
Riffle cross sections are a unique type of cross section drawn within a riffle stream feature. In contrast to regularly spaced cross sections that are delineated by a script, riffles irregularly spaced along a stream and are manually drawn by a GIS analyst. Analysts are trained to identify riffles using a set of guidelines from the literature and interpretation of the DEM and aerial imagery. The `riffle_floodplain` polyline feature class is drawn longitudinally within riffle features and extend laterally across the active floodplain. The `riffle_channel` polyline feature class is also drawn longitudinally within riffle features, but only extend laterally across the bankfull channel area. 

### Cross Section Points
Cross sections polyline feature classes (i.e., regularly spaced cross sections, `riffle_floodplain`, `riffle_channel`) can be converted to a set of regularly spaced points along the cross section. These points are used to store elevation and route position (lateral stream stationing) information for a cross section feature class. Cross section points are used to calculate a series of cross section dimensions. 

### Cross Section Dimensions
Cross section dimension polyline feature classes are used to store the hydraulic dimensions calculated for each cross section. As described above, the FluvialGeomorph workflow is divided into three levels. Based on the level of detail of the analysis at each level, a certain set of dimensions can be calculated. Each level allows for an increasingly complex set of dimensions to be calculated, each level building on the complexity of the previous level. 

### Bankfull Area
The `bankfull_area` polygon feature class represents the channel area typically inundated during bankfull events. The `detrend` raster dataset is used to "flood" the channel to define this extent. 

### Banklines
The `banklines` polyline feature class represents the stream banks at bankfull. The edge of the `bankfull_area` polygon features are used to create to banklines, one representing the left descending bank and another the right descending bank. 

### Bankline Points
The `bankline_points` point feature class is a set of regularly spaced point features located along each `banklines` feature. These points are used to store elevation and route position (longitudinal bankline stationing) information for each bankline. 

### Centerline
The `centerline` polyline feature class is used to represent a stream flow path that fally roughly equidistant between the banklines at bankfull. 

### Valleyline
The `valleyline` polyline feature class represents the trend line of the down-valley axis. It bisects stream meanders as the stream swings from side to side across its floodplain. 

### Loop Points
The `loop_points` point feature class is used to store the longitudinal extents of loops and bends used for planform analysis. Within the FluvialGeomorph toolbox, the term "loop" is defined as a single meander as it swings across the `valleyline`. Moving downstream along a single loop, once the stream swings substantially across the valleyline, another loop begins. The point of maximum distance of a flowline from the valeyline (laterally across the floodplain) defines a loop "apex". Moving to a finer scale, "bends" are defined as stream undulations within a particular loop. Therefore, a single loop may contain many bends. These loop and bend extents and loop apices are used to calculate a set of planform dimensions. 

### Features
The `features` point feature class is used to identify and label key stream features and their longitudinal position. Instances of features typically include relevant tributaries, localities, and infrastructure built within the floodplain affecting flow. 


## Workflows
Provide a narrative overview of the workflow. 
```{r echo=FALSE, out.width="100%", fig.cap="Workflow Diagram"}
include_graphics("images/Workflow_watershed.png")
```

* Provide roadmap or overview of the stages users need to take. 
* Help orient users with overview to give them the big picture before throwing them into the details. 

* Describe Stages, Steps, Tasks and Tools

## Workflow Stages
* Describe how the workflow is divided into stages and each stage contains steps. 

* 

### Create Terrain
* What will be accomplished for each stage?
* Describe how previous stage (outputs) flows into the current stage (inputs). 

### Define Watershed Reaches

### Detrend DEM

### Define Channel Extent

### Map Riffles

### Calculate Riffle Geometry

### Estimate Bankfull

### Layout Cross Sections

### Calculate Cross Section Geometry

### Calculate Planform Geometry

